Una empresa de distribución de energía eléctrica posee un archivo maestro con los siguientes datos de sus clientes
(la fecha de última lectura son las mediciones realizadas hasta el mes de mayo del 2014):

CLIENTE Ordenado por Id_Casa

|Id_Casa |Fecha_Ult_Lectura |Cant_Lecturas |Prom_Lecturas |Tipo_Consumidor|
El campo tipo de consumidor puede ser:

A (cuando el promedio de lectura es menor a 20K)
B (cuando el promedio de lectura es menor a 40K)
C (cuando el promedio de lectura es igual o supera los 40K)
Cuenta además con el siguiente archivo con datos de las mediciones realizadas en los dos últimos años (desde junio del
2014 hasta junio del 2016)

Mediciones Ordenado por Id_Casa

|Id_Casa | Fecha_Medicion |Consumo|
Se pide actualizar el archivo maestro con la información de las lecturas hasta el mes de enero del año 2015 inclusive.
Los campos que se deben actualizar son: la fecha de ultima lectura, cantidad de lecturas, el promedio y modificar
(en caso de ser necesario) el tipo de consumidor. En caso en que no exista el ID casa (una conexión nueva) se tiene que
 crear en el maestro y actualizar los otros campos.

ACCION 2.2.24 ES
    AMBIENTE
        FECHA = REGISTRO
            año: N(4)
            mes: 1..12
            dia: 1..31
        FIN_REGISTRO

        cliente = REGISTRO
            id_casa: entero
            fecha_ult_lectura: FECHA
            cant_lecturas: entero
            Prom_lecturas: real
            tipo_consumidor: ("A","B","C")
        FIN_REGISTRO
        MaeOld, MaeAct: Archivo de cliente ordenado por id_casa
        RegMaeOld, RegMaeAct, Aux: cliente

        mediciones = REGISTRO
            id_casa: entero
            fecha_medición: FECHA
            consumo: entero
        FIN_REGISTRO
        Mov: Archivo de mediciones ordenado por id_casa
        RegMov: mediciones

        cant_lecturas: entero
        consumo_total: real
        Fecha_limite: FECHA

        PROCEDIMIENTO LEER_mov() ES
            LEER(Mov, RegMov)
            SI FDA(Mov) ENTONCES
                RegMov.id_casa:= HV
            FIN_SI
        FIN_PROCEDIMIENTO

        PROCEDIMIENTO LEER_mae() ES
            LEER(MaeOld, RegMaeOld)
            SI FDA(MaeOld) ENTONCES
                RegMaeOld.id_casa:= HV
            FIN_SI
        FIN_PROCEDIMIENTO

    PROCESO
        ABRIR E/(MaeOld); ABRIR E/(Mov)
        ABRIR /S(MaeAct)

        LEER_mae()
        LEER_mov()

        fecha_limite.año:= 2015
        fecha_limite.mes:= 1
        fecha_limite.dia:= 31

        MIENTRAS (RegMaeOld.id_casa <> HV) O (RegMov.id_casa <> HV) HACER
            SI RegMaeOld.id_casa < RegMov.id_casa ENTONCES
                RegMaeAct:= RegMaeOld
                ESC(MaeAct, RegMaeAct)
                LEER_mae()
            SINO
                SI RegMaeOld.id_casa = RegMov.id_casa ENTONCES
                    cant_lecturas:= 0
                    consumo_total:= 0
                    Aux:= RegMaeOld
                    MIENTRAS RegMaeOld.id_casa = RegMov.id_casa HACER
                        SI RegMov.fecha_medición < fecha_limite ENTONCES
                            consumo_total:= consumo_total + RegMov.consumo
                            cant_lecturas:= cant_lecturas + 1
                            Aux.fecha_ult_lectura:= RegMov.fecha_medición
                        FIN_SI

                        LEER_mov()
                    FIN_MIENTRAS

                    Aux.cant_lecturas:= cant_lecturas
                    Aux.Prom_lecturas:= consumo_total/cant_lecturas
                    SEGUN Aux.Prom_lecturas HACER
                        < 20000: Aux.tipo_consumidor:= "A"
                        < 40000: Aux.tipo_consumidor:= "B"
                        Otro: Aux.tipo_consumidor:= "C"
                    FIN_SEGUN

                    RegMaeAct:= Aux
                    ESC(MaeAct, RegMaeAct)
                    LEER_Mae()
                SINO
                    SI RegMov.fecha_medición < fecha_limite ENTONCES
                        Aux.id_casa := RegMov.id_casa
                        Aux.fecha_ult_lectura:= RegMov.fecha_medición
                        Aux.cant_lecturas:= 1
                        cant_lecturas:= 1
                        Aux.Prom_lecturas:= RegMov.consumo
                        consumo_total:= RegMov.consumo

                        SEGUN Aux.Prom_lecturas HACER
                            < 20000: Aux.tipo_consumidor:= "A"
                            < 40000: Aux.tipo_consumidor:= "B"
                            Otro: Aux.tipo_consumidor:= "C"
                        FIN_SEGUN

                        LEER_mov()
                        MIENTRAS Aux.id_casa = RegMov.id_casa HACER
                            consumo_total:= consumo_total + RegMov.consumo
                            cant_lecturas:= cant_lecturas + 1
                            Aux.fecha_ult_lectura:= RegMov.fecha_medición

                            LEER_mov()
                        FIN_MIENTRAS

                        Aux.cant_lecturas:= cant_lecturas
                        Aux.Prom_lecturas:= consumo_total/cant_lecturas
                        SEGUN Aux.Prom_lecturas HACER
                            < 20000: Aux.tipo_consumidor:= "A"
                            < 40000: Aux.tipo_consumidor:= "B"
                            Otro: Aux.tipo_consumidor:= "C"
                        FIN_SEGUN

                        RegMaeAct:= Aux
                        ESC(MaeAct, RegMaeAct)
                    SINO
                        LEER_mov()
                    FIN_SI
                FIN_SI
            FIN_SI
        FIN_MIENTRAS

        CERRAR(Mov)
        CERRAR(MaeAct)
        CERRAR(MaeOld)
FIN_ACCION